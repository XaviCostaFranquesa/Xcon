<html lang="es"><head><script>(function(firebaseConfig, initialAuthToken, appId) {
        window.__firebase_config = firebaseConfig;
        window.__initial_auth_token = initialAuthToken;
        window.__app_id = appId;
            })("\n{\n  \"apiKey\": \"AIzaSyCqyCcs2R2e7AegGjvFAwG98wlamtbHvZY\",\n  \"authDomain\": \"bard-frontend.firebaseapp.com\",\n  \"projectId\": \"bard-frontend\",\n  \"storageBucket\": \"bard-frontend.firebasestorage.app\",\n  \"messagingSenderId\": \"175205271074\",\n  \"appId\": \"1:175205271074:web:2b7bd4d34d33bf38e6ec7b\"\n}\n","eyJhbGciOiJSUzI1NiIsImtpZCI6ImQ1OTQzZDdlNWZhYTIxZjcyOTJjMzI3MGY3ZDBjNWJmNDE5MjJmOTciLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmaXJlYmFzZS1hZG1pbnNkay1mYnN2Y0BiYXJkLWZyb250ZW5kLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwiYXVkIjoiaHR0cHM6Ly9pZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20vZ29vZ2xlLmlkZW50aXR5LmlkZW50aXR5dG9vbGtpdC52MS5JZGVudGl0eVRvb2xraXQiLCJ1aWQiOiIwMTYyMDM0NjUzODkxNDI2MTk1NCIsImlzcyI6ImZpcmViYXNlLWFkbWluc2RrLWZic3ZjQGJhcmQtZnJvbnRlbmQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCJjbGFpbXMiOnsiYXBwSWQiOiJjXzM3YmRjNGIzMTEyODM1Y2NfaW5kZXguaHRtbC05MCJ9LCJleHAiOjE3NzA2NDkzMTUsImlhdCI6MTc3MDY0NTcxNSwiYWxnIjoiUlMyNTYifQ.W0fSeyHVEh_fQnNaDmXSzk_copP8b08Q7kKQjj71XnQLjYFEsvhuWu12ZQRdRnLQ4pCsdypU4vJ7bOubOd91IJo-B2Ojb-zNghcqUilcLv6FzyOR1hEcW8rtvcBRrY0J1ahGj3bWY77EeXpEj-7n9lm0iO6g9Pkk1CWk18FA59xguQew84ltDupV_5seA-GkAZs7n9w87NjfNhmasahDkn6_pw0n-PQHS52t34Y9I3Tav68RVVfrHP_O46d63NA-lBqQbdjGCGT7n62kf0Bin5JhA8S-jdIIJM74HGztY1C42AxQTYVhViNleyzE7tIHmkUJfp-66f8RL_q5C27RFQ","c_37bdc4b3112835cc_index.html-90")</script><script>'use strict';var h=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,b,d){if(a==Array.prototype||a==Object.prototype)return a;a[b]=d.value;return a};function l(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var d=a[b];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");}var n=l(this);
function p(a,b){if(b)a:{var d=n;a=a.split(".");for(var c=0;c<a.length-1;c++){var e=a[c];if(!(e in d))break a;d=d[e]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&b!=null&&h(d,a,{configurable:!0,writable:!0,value:b})}}function r(a){function b(c){return a.next(c)}function d(c){return a.throw(c)}return new Promise(function(c,e){function f(g){g.done?c(g.value):Promise.resolve(g.value).then(b,d).then(f,e)}f(a.next())})}function t(a){return r(a())}
p("Object.values",function(a){return a?a:function(b){var d=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&d.push(b[c]);return d}});p("Array.prototype.includes",function(a){return a?a:function(b,d){var c=this;c instanceof String&&(c=String(c));var e=c.length;d=d||0;for(d<0&&(d=Math.max(d+e,0));d<e;d++){var f=c[d];if(f===b||Object.is(f,b))return!0}return!1}});/*

 MIT License

 Copyright (c) 2017-2023 W.Y.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 SOFTWARE.

*/
function u(a,b){const d=a.style;b.backgroundColor&&(d.backgroundColor=b.backgroundColor);b.width&&(d.width=`${b.width}px`);b.height&&(d.height=`${b.height}px`);const c=b.style;c!=null&&Object.keys(c).forEach(e=>{d[e]=c[e]})};var v=(()=>{let a=0;return()=>{a+=1;return`u${`0000${(Math.random()*1679616<<0).toString(36)}`.slice(-4)}${a}`}})();function w(a){const b=[];for(let d=0,c=a.length;d<c;d++)b.push(a[d]);return b}let x=null;function y(a={}){return x?x:a.l?x=a.l:x=w(window.getComputedStyle(document.documentElement))}function z(a,b){return(a=(a.ownerDocument.defaultView||window).getComputedStyle(a).getPropertyValue(b))?parseFloat(a.replace("px","")):0}
function A(a,b={}){var d;if(!(d=b.width)){d=z(a,"border-left-width");var c=z(a,"border-right-width");d=a.clientWidth+d+c}(b=b.height)||(b=z(a,"border-top-width"),c=z(a,"border-bottom-width"),b=a.clientHeight+b+c);return{width:d,height:b}}function B(a){return new Promise((b,d)=>{const c=new Image;c.onload=()=>{c.decode().then(()=>{requestAnimationFrame(()=>b(c))})};c.onerror=d;c.crossOrigin="anonymous";c.decoding="async";c.src=a})}
function C(a){return t(function*(){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(a)).then(encodeURIComponent).then(b=>`data:image/svg+xml;charset=utf-8,${b}`)})}
function D(a,b,d){return t(function*(){const c=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");c.setAttribute("width",`${b}`);c.setAttribute("height",`${d}`);c.setAttribute("viewBox",`0 0 ${b} ${d}`);e.setAttribute("width","100%");e.setAttribute("height","100%");e.setAttribute("x","0");e.setAttribute("y","0");e.setAttribute("externalResourcesRequired","true");c.appendChild(e);e.appendChild(a);return C(c)})}
var E=(a,b)=>{if(a instanceof b)return!0;a=Object.getPrototypeOf(a);return a===null?!1:a.constructor.name===b.name||E(a,b)};function F(a,b){return y(b).map(d=>{const c=a.getPropertyValue(d),e=a.getPropertyPriority(d);return`${d}: ${c}${e?" !important":""};`}).join(" ")}
function G(a,b,d,c){a=window.getComputedStyle(a,d);var e=a.getPropertyValue("content");if(e!==""&&e!=="none"){var f=v();try{b.className=`${b.className} ${f}`}catch(k){return}e=document.createElement("style");var g=e.appendChild;d=`.${f}:${d}`;a.cssText?(c=a.getPropertyValue("content"),c=`${a.cssText} content: '${c.replace(/'|"/g,"")}';`):c=F(a,c);g.call(e,document.createTextNode(`${d}{${c}}`));b.appendChild(e)}};function H(a){return a.search(/^(data:)/)!==-1}function I(a,b,d){return t(function*(){const c=yield fetch(a,b);if(c.status===404)throw Error(`Resource "${c.url}" not found`);const e=yield c.blob();return new Promise((f,g)=>{const k=new FileReader;k.onerror=g;k.onloadend=()=>{try{f(d({o:c,result:k.result}))}catch(m){g(m)}};k.readAsDataURL(e)})})}const J={};function K(a,b,d){let c=a.replace(/\?.*/,"");d&&(c=a);/ttf|otf|eot|woff2?/i.test(c)&&(c=c.replace(/.*\//,""));return b?`[${b}]${c}`:c}
function L(a,b,d){return t(function*(){const c=K(a,b,d.C);if(J[c]!=null)return J[c];d.u&&(a+=(/\?/.test(a)?"&":"?")+(new Date).getTime());let e;try{const f=yield I(a,d.i,({o:g,result:k})=>{b||(b=g.headers.get("Content-Type")||"");return k.split(/,/)[1]});e=`data:${b};base64,${f}`}catch(f){e=d.B||""}return J[c]=e})};const M={P:"application/font-woff",R:"application/font-woff",N:"application/font-truetype",v:"application/vnd.ms-fontobject",H:"image/png",F:"image/jpeg",D:"image/jpeg",A:"image/gif",M:"image/tiff",L:"image/svg+xml",O:"image/webp"};function N(a){return(a=/\.([^./]*?)$/g.exec(a))?a[1]:""};function O(a){return t(function*(){const b=a.toDataURL();return b==="data:,"?a.cloneNode(!1):B(b)})}function aa(a,b){return t(function*(){if(a.currentSrc){var d=document.createElement("canvas");const c=d.getContext("2d");d.width=a.clientWidth;d.height=a.clientHeight;c==null||c.drawImage(a,0,0,d.width,d.height);d=d.toDataURL();return B(d)}d=a.poster;d=yield L(d,M[N(d).toLowerCase()]||"",b);return B(d)})}
function ba(a,b){return t(function*(){try{let d;if(a==null?0:(d=a.contentDocument)==null?0:d.body)return yield P(a.contentDocument.body,b,!0)}catch(d){}return a.cloneNode(!1)})}function ca(a,b){return t(function*(){return E(a,HTMLCanvasElement)?O(a):E(a,HTMLVideoElement)?aa(a,b):E(a,HTMLIFrameElement)?ba(a,b):a.cloneNode(a.tagName!=null&&a.tagName.toUpperCase()==="SVG")})}
function da(a,b,d){return t(function*(){if(b.tagName!=null&&b.tagName.toUpperCase()==="SVG")return b;let c=[];if(a.tagName!=null&&a.tagName.toUpperCase()==="SLOT"&&a.assignedNodes)c=w(a.assignedNodes());else{let e;if(E(a,HTMLIFrameElement)&&((e=a.contentDocument)==null?0:e.body))c=w(a.contentDocument.body.childNodes);else{let f;c=w(((f=a.shadowRoot)!=null?f:a).childNodes)}}if(c.length===0||E(a,HTMLVideoElement))return b;yield c.reduce((e,f)=>e.then(()=>P(f,d)).then(g=>{g&&b.appendChild(g)}),Promise.resolve());
return b})}function ea(a,b,d){const c=b.style;if(c){var e=window.getComputedStyle(a);e.cssText?(c.cssText=e.cssText,c.transformOrigin=e.transformOrigin):y(d).forEach(f=>{let g=e.getPropertyValue(f);f==="font-size"&&g.endsWith("px")&&(g=`${Math.floor(parseFloat(g.substring(0,g.length-2)))-.1}px`);E(a,HTMLIFrameElement)&&f==="display"&&g==="inline"&&(g="block");f==="d"&&b.getAttribute("d")&&(g=`path(${b.getAttribute("d")})`);c.setProperty(f,g,e.getPropertyPriority(f))})}}
function fa(a,b){E(a,HTMLSelectElement)&&(b=Array.from(b.children).find(d=>a.value===d.getAttribute("value")))&&b.setAttribute("selected","")}
function ha(a,b){return t(function*(){var d=a.querySelectorAll?a.querySelectorAll("use"):[];if(d.length===0)return a;var c={};for(var e=0;e<d.length;e++){var f=d[e].getAttribute("xlink:href");if(f){const g=document.querySelector(f);a.querySelector(f)||!g||c[f]||(c[f]=yield P(g,b,!0))}}d=Object.values(c);if(d.length){c=document.createElementNS("http://www.w3.org/1999/xhtml","svg");c.setAttribute("xmlns","http://www.w3.org/1999/xhtml");c.style.position="absolute";c.style.width="0";c.style.height="0";
c.style.overflow="hidden";c.style.display="none";e=document.createElementNS("http://www.w3.org/1999/xhtml","defs");c.appendChild(e);for(f=0;f<d.length;f++)e.appendChild(d[f]);a.appendChild(c)}return a})}
function P(a,b,d){return t(function*(){return d||!b.filter||b.filter(a)?Promise.resolve(a).then(c=>ca(c,b)).then(c=>da(a,c,b)).then(c=>{E(c,Element)&&(ea(a,c,b),G(a,c,":before",b),G(a,c,":after",b),E(a,HTMLTextAreaElement)&&(c.textContent=a.value),E(a,HTMLInputElement)&&c.setAttribute("value",a.value),fa(a,c));return c}).then(c=>ha(c,b)):null})};const Q=/url\((['"]?)([^'"]+?)\1\)/g,ia=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,ja=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ka(a){const b=[];a.replace(Q,(d,c,e)=>{b.push(e);return d});return b.filter(d=>!H(d))}
function la(a,b,d,c){return t(function*(){try{const e=d?(new URL(b,d||void 0)).toString():b;let f;f=yield L(e,M[N(b).toLowerCase()]||"",c);return a.replace(new RegExp(`(url\\(['"]?)(${b.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")})(['"]?\\))`,"g"),`$1${f}$3`)}catch(e){}return a})}function ma(a,{I:b}){return b?a.replace(ja,d=>{for(;;){const [c,,e]=ia.exec(d)||[],f=c,g=e;if(!g)return"";if(g===b)return`src: ${f};`}}):a}
function R(a,b,d){return t(function*(){if(a.search(Q)===-1)return a;const c=ma(a,d);return ka(c).reduce((e,f)=>e.then(g=>la(g,f,b,d)),Promise.resolve(c))})};function S(a,b,d){return t(function*(){var c;const e=(c=b.style)==null?void 0:c.getPropertyValue(a);return e?(c=yield R(e,null,d),b.style.setProperty(a,c,b.style.getPropertyPriority(a)),!0):!1})}function na(a,b){return t(function*(){(yield S("background",a,b))||(yield S("background-image",a,b));(yield S("mask",a,b))||(yield S("-webkit-mask",a,b))||(yield S("mask-image",a,b))||(yield S("-webkit-mask-image",a,b))})}
function oa(a,b){return t(function*(){const d=E(a,HTMLImageElement);if(d&&!H(a.src)||E(a,SVGImageElement)&&!H(a.href.baseVal)){var c=d?a.src:a.href.baseVal,e=yield L(c,M[N(c).toLowerCase()]||"",b);yield new Promise((f,g)=>{a.onload=f;a.onerror=b.m?(...k)=>{try{f(b.m(...k))}catch(m){g(m)}}:g;a.decode&&(a.decode=f);a.loading==="lazy"&&(a.loading="eager");d?(a.srcset="",a.src=e):a.href.baseVal=e})}})}
function pa(a,b){return t(function*(){const d=w(a.childNodes).map(c=>T(c,b));yield Promise.all(d).then(()=>a)})}function T(a,b){return t(function*(){E(a,Element)&&(yield na(a,b),yield oa(a,b),yield pa(a,b))})};const U={};function V(a){return t(function*(){var b=U[a];if(b!=null)return b;b=yield(yield fetch(a)).text();b={url:a,cssText:b};return U[a]=b})}function W(a,b){return t(function*(){let d=a.cssText;const c=/url\(["']?([^"')]+)["']?\)/g,e=(d.match(/url\([^)]+\)/g)||[]).map(f=>t(function*(){let g=f.replace(c,"$1");g.startsWith("https://")||(g=(new URL(g,a.url)).href);return I(g,b.i,({result:k})=>{d=d.replace(f,`url(${k})`);return[f,k]})}));return Promise.all(e).then(()=>d)})}
function X(a){if(a==null)return[];const b=[];a=a.replace(/(\/\*[\s\S]*?\*\/)/gi,"");for(var d=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");;){var c=d.exec(a);if(c===null)break;b.push(c[0])}a=a.replace(d,"");d=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi;for(c=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");;){let e=d.exec(a);if(e===null)if(e=c.exec(a),e===null)break;else d.lastIndex=c.lastIndex;else c.lastIndex=
d.lastIndex;b.push(e[0])}return b}
function qa(a,b){return t(function*(){const d=[],c=[];a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach((f,g)=>{if(f.type===CSSRule.IMPORT_RULE){let k=g+1;f=V(f.href).then(m=>W(m,b)).then(m=>X(m).forEach(q=>{try{e.insertRule(q,q.startsWith("@import")?k+=1:e.cssRules.length)}catch(Da){}})).catch(()=>{});c.push(f)}})}catch(f){const g=a.find(k=>k.href==null)||document.styleSheets[0];e.href!=null&&c.push(V(e.href).then(k=>W(k,b)).then(k=>X(k).forEach(m=>{g.insertRule(m,g.cssRules.length)})).catch(()=>
{}))}});return Promise.all(c).then(()=>{a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach(f=>{d.push(f)})}catch(f){}});return d})})}function ra(a){return a.filter(b=>b.type===CSSRule.FONT_FACE_RULE).filter(b=>b.style.getPropertyValue("src").search(Q)!==-1)}function sa(a,b){return t(function*(){if(a.ownerDocument==null)throw Error("Provided element is not within a Document");var d=w(a.ownerDocument.styleSheets);d=yield qa(d,b);return ra(d)})}
function ta(a){function b(c){(c.style.fontFamily||getComputedStyle(c).fontFamily).split(",").forEach(e=>{d.add(e.trim().replace(/["']/g,""))});Array.from(c.children).forEach(e=>{e instanceof HTMLElement&&b(e)})}const d=new Set;b(a);return d}function ua(a,b){return t(function*(){const d=yield sa(a,b),c=ta(a);return(yield Promise.all(d.filter(e=>c.has(e.style.fontFamily.trim().replace(/["']/g,""))).map(e=>R(e.cssText,e.parentStyleSheet?e.parentStyleSheet.href:null,b)))).join("\n")})}
function va(a,b){return t(function*(){const d=b.j!=null?b.j:b.K?null:yield ua(a,b);if(d){const c=document.createElement("style");c.appendChild(document.createTextNode(d));a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)}})};function wa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b),e=yield P(a,b,!0);yield va(e,b);yield T(e,b);u(e,b);return yield D(e,d,c)})}
function xa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b);var e=yield wa(a,b);e=yield B(e);const f=document.createElement("canvas"),g=f.getContext("2d"),k=b.G||window.devicePixelRatio||1,m=b.h||d,q=b.g||c;f.width=m*k;f.height=q*k;!b.J&&(f.width>16384||f.height>16384)&&(f.width>16384&&f.height>16384?f.width>f.height?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=16384):f.width>16384?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=
16384));f.style.width=`${m}`;f.style.height=`${q}`;b.backgroundColor&&(g.fillStyle=b.backgroundColor,g.fillRect(0,0,f.width,f.height));g.drawImage(e,0,0,f.width,f.height);return f})}function ya(a,b={}){return t(function*(){return(yield xa(a,b)).toDataURL()})};const za=["gemini.google.com","corp.google.com","proxy.googlers.com"];function Y(){return document.body.querySelectorAll('[class*="animate"]').length>0}function Z(a){return t(function*(){try{return yield ya(a,{h:a.offsetWidth,g:a.offsetHeight})}catch(d){var b=a.offsetHeight;const c=document.createElement("canvas");c.width=a.offsetWidth;c.height=b;return c.toDataURL("image/png")}})}
function Aa(){return t(function*(){const a=document.body.offsetWidth,b=document.body.offsetHeight,d=document.body.cloneNode(!0);d.querySelectorAll('[class*="animate"]').forEach(c=>{c.classList.remove(...Array.from(c.classList).filter(e=>e.startsWith("animate")))});d.style.width=`${a}px`;d.style.height=`${b}px`;return d})}
function Ba(a){return t(function*(){let b=document.body;if(Y()){var d=yield Aa();b=d;document.body.appendChild(d)}d=yield Z(b);Y()&&document.body.removeChild(b);window.parent.postMessage({type:"SEND_SCREENSHOT",image:d,topOffset:document.documentElement.scrollTop},a.origin)})}function Ca(a){return t(function*(){const b={type:"SEND_SCREENSHOT_FOR_DATA_VISUALIZATION",image:yield Z(document.body),topOffset:0};window.parent.postMessage(b,a.origin)})}
window.addEventListener("message",a=>t(function*(){if(za.some(d=>a.origin.includes(d))){var b=a.data;b&&(b.type==="MAKE_SCREENSHOT"&&(yield Ba(a)),b.type==="MAKE_SCREENSHOT_FOR_DATA_VISUALIZATION"&&(yield Ca(a)))}}));
</script><script>(function() {
  // Ensure this script is executed only once
  if (window.firebaseAuthBridgeScriptLoaded) {
    return;
  }
  window.firebaseAuthBridgeScriptLoaded = true;

  let nextTokenPromiseId = 0;

  // Stores { resolve, reject } for ongoing token requests
  const pendingTokenPromises = {};

  // Listen for messages from the Host Application
  window.addEventListener('message', function(event) {

    const messageData = event.data;

  if (messageData && messageData.type === 'RESOLVE_NEW_FIREBASE_TOKEN') {
      const { success, token, error, promiseId } = messageData ?? {};
      if (pendingTokenPromises[promiseId]) {
        if (success) {
          pendingTokenPromises[promiseId].resolve(token);
        } else {
          pendingTokenPromises[promiseId].reject(new Error(error || 'Token refresh failed from host.'));
        }
        delete pendingTokenPromises[promiseId];
      }
    }
  });

  // Expose a function for the Generated App to request a new Firebase token
  window.requestNewFirebaseToken = function() {
    const currentPromiseId = nextTokenPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingTokenPromises[currentPromiseId] = { resolve, reject };
    });
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'REQUEST_NEW_FIREBASE_TOKEN',
        promiseId: currentPromiseId
      }, '*');
    } else {
      pendingTokenPromises[currentPromiseId].reject(new Error('No parent window to request token from.'));
      delete pendingTokenPromises[currentPromiseId];
    }
    return promise;
  };
})();</script><script>
let realOriginalGetUserMedia = null;
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  realOriginalGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
}

(function() {
  if (navigator.mediaDevices && navigator.mediaDevices.__proto__) {
    try {
      Object.defineProperty(navigator.mediaDevices.__proto__, 'getUserMedia', {
        get: function() {
          return undefined; // Or throw an error
        },
        configurable: false
      });
    } catch (error) {
      console.error("Error defining prototype getter:", error);
    }
  }
})();

(function() {
  const pendingMediaResolvers = {};
  let nextMediaPromiseId = 0;

  function requestMediaPermissions(constraints) {
    const mediaPromiseId = nextMediaPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingMediaResolvers[mediaPromiseId] = (granted) => {
        delete pendingMediaResolvers[mediaPromiseId];
        resolve(granted);
      };
    });

    window.parent.postMessage({
      type: 'requestMediaPermission',
      constraints: constraints,
      promiseId: mediaPromiseId,
    }, '*');

    return promise;
  }

  let originalGetUserMedia = realOriginalGetUserMedia;

  function interceptGetUserMedia() {
    if (navigator.mediaDevices) {
      Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
        value: function(constraints) {
          return requestMediaPermissions(constraints).then((granted) => {
            if (granted) {
              if (originalGetUserMedia) {
                return originalGetUserMedia(constraints);
              } else {
                throw new Error("Original getUserMedia not available.");
              }
            } else {
              throw new DOMException('Permission denied', 'NotAllowedError');
            }
          });
        },
        writable: false,
        configurable: false
      });
    }
  }

  interceptGetUserMedia();

  const observer = new MutationObserver(function(mutationsList, observer) {
    for (const mutation of mutationsList) {
      if (mutation.type === 'reconfigured' && mutation.name === 'getUserMedia' && mutation.object === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'attributes' && mutation.attributeName === 'getUserMedia' && mutation.target === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'childList' && mutation.addedNodes) {
        mutation.addedNodes.forEach(node => {
          if (node === navigator.mediaDevices) {
            interceptGetUserMedia();
          }
        });
      }
    }
  });

  function interceptSpeechRecognition() {
    if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
      return;
    }

    const OriginalSpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    const SpeechRecognitionWrapper = function(...args) {
      const recognizer = new OriginalSpeechRecognition(...args);
      const originalStart = recognizer.start.bind(recognizer);

      recognizer.start = function() {
        requestMediaPermissions({ audio: true }).then(granted => {
          if (granted) {
            originalStart();
          } else {
            const errorEvent = new SpeechRecognitionErrorEvent('error');
            errorEvent.error = 'not-allowed'; // This is the standard error for permission denial.
            recognizer.dispatchEvent(errorEvent);
          }
        });
      };

      return recognizer;
    };

    SpeechRecognitionWrapper.prototype = OriginalSpeechRecognition.prototype;
    SpeechRecognitionWrapper.prototype.constructor = SpeechRecognitionWrapper;

    if (window.SpeechRecognition) {
      window.SpeechRecognition = SpeechRecognitionWrapper;
    }
    if (window.webkitSpeechRecognition) {
      window.webkitSpeechRecognition = SpeechRecognitionWrapper;
    }
  }

  interceptSpeechRecognition();

  window.addEventListener('message', function(event) {
    if (event.data) {
      if (event.data.type === 'resolveMediaPermission') {
        const { promiseId, granted } = event.data;
        if (pendingMediaResolvers[promiseId]) {
          pendingMediaResolvers[promiseId](granted);
        }
      }
    }
  });

})();</script><script>((function(modelInformation) {
  const originalFetch = window.fetch;
  // TODO: b/421908508 - Move these out of the script and match all generative AI model calls.
  let googleLlmBaseApiUrls = [
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':streamGenerateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageEditModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageTransformModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.ttsModelName + ':generateContent',
  ];
  modelInformation.deprecatedTextModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':streamGenerateContent',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':generateContent',
    );
  });
  modelInformation.deprecatedImageModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predict',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predictLongRunning',
    );
  });

  const pendingFetchResolvers = {};
  let nextPromiseId = 0;

  function handleStringInput(input, optionsArgument) {
    const actualUrl = input;
    const fetchCallArgs = [actualUrl, optionsArgument];
    const effectiveOptions = optionsArgument || {};
    const bodyForApiKeyCheck = effectiveOptions.body;
    const bodyForPostMessage = effectiveOptions.body;
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  function handleRequestInput(input, optionsArgument) {
    const actualUrl = input.url;
    const fetchCallArgs = [input, optionsArgument];
    const effectiveOptions = { method: input.method, headers: new Headers(input.headers) };
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (optionsArgument) {
      if (optionsArgument.method) effectiveOptions.method = optionsArgument.method;
      if (optionsArgument.headers) effectiveOptions.headers = new Headers(optionsArgument.headers);
      if ('body' in optionsArgument) {
        bodyForApiKeyCheck = optionsArgument.body;
        bodyForPostMessage = optionsArgument.body;
      } else {
        bodyForApiKeyCheck = undefined;
        bodyForPostMessage = input.body;
      }
    } else {
      bodyForApiKeyCheck = undefined;
      bodyForPostMessage = input.body;
    }
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  window.fetch = function(input, optionsArgument) {
    let actualUrl;
    let fetchCallArgs;
    let effectiveOptions = {};
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (typeof input === 'string') {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleStringInput(input, optionsArgument));
    } else if (input instanceof Request) {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleRequestInput(input, optionsArgument));
    } else {
      return originalFetch.apply(window, [input, optionsArgument]);
    }

    effectiveOptions.method = effectiveOptions.method || 'GET';
    if (!effectiveOptions.headers) {
      effectiveOptions.headers = new Headers();
    }


    if (typeof actualUrl === 'string' && googleLlmBaseApiUrls.some((url) => actualUrl.startsWith(url))) {
      let apiKeyIsNull = true;

      const regex = new RegExp("models/([^:]+)");
      const modelNameMatch = actualUrl.match(regex);
      const modelName = modelNameMatch ? modelNameMatch[1] : 'unspecified';


      try {
        const urlObject = new URL(actualUrl);  // Use URL object for robust parsing
        const apiKeyParam = urlObject.searchParams.get('key');
        if (apiKeyParam) {
          apiKeyIsNull = false;
        }
      } catch (e) {
        // Continue checks even if URL parsing fails
      }

      if (apiKeyIsNull && effectiveOptions.headers) {
        const h = new Headers(effectiveOptions.headers);
        const apiKeyHeaderValue = h.get('X-API-Key') || h.get('x-api-key');
        if (apiKeyHeaderValue) {
          apiKeyIsNull = false;
          return originalFetch.apply(window, fetchCallArgs);
        }
      }

      if (apiKeyIsNull && effectiveOptions.method && ['POST', 'PUT', 'PATCH'].includes(effectiveOptions.method.toUpperCase()) && typeof bodyForApiKeyCheck === 'string') {
        try {
          const bodyData = JSON.parse(bodyForApiKeyCheck);
          if (bodyData && bodyData.apiKey) {
            apiKeyIsNull = false;
            return originalFetch.apply(window, fetchCallArgs);
          }
        } catch (e) {
          // Ignore JSON parsing errors
        }
      }

      if(apiKeyIsNull) {
        const promiseId = nextPromiseId++;
        const promise = new Promise((resolve) => {
          pendingFetchResolvers[promiseId] = (resolvedResponse) => {
            delete pendingFetchResolvers[promiseId];
            resolve(resolvedResponse);
          };
        });

        let serializedBodyForPostMessage;
        if (typeof bodyForPostMessage === 'string' || bodyForPostMessage == null) {
            serializedBodyForPostMessage = bodyForPostMessage;
        } else if (bodyForPostMessage instanceof ReadableStream) {
            serializedBodyForPostMessage = null;
        } else {
            try {
                serializedBodyForPostMessage = JSON.stringify(bodyForPostMessage);
            } catch (e) {
                serializedBodyForPostMessage = null;
            }
        }

        const messageOptions = {
            method: effectiveOptions.method,
            headers: Object.fromEntries(new Headers(effectiveOptions.headers).entries()),
            body: serializedBodyForPostMessage
        };

        window.parent.postMessage({
          type: 'requestFetch',
          url: actualUrl,
          modelName: modelName,
          options: messageOptions,
          promiseId: promiseId,
        }, '*');

        return promise;
      }
      return originalFetch.apply(window, fetchCallArgs);
    }
    return originalFetch.apply(window, fetchCallArgs);
  };

  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'resolveFetch') {
      const { promiseId, response } = event.data;
      if (pendingFetchResolvers[promiseId]) {
        try {
          const reconstructedResponse = new Response(response.body, {
            status: response.status,
            statusText: response.statusText,
            headers: new Headers(response.headers),
          });
          pendingFetchResolvers[promiseId](reconstructedResponse);
        } catch (error) {
          pendingFetchResolvers[promiseId](new Response(null, { status: 500, statusText: "Interceptor Response Reconstruction Error" }));
        }
      }
    }
  });

}))({"textModelName":"gemini-2.5-flash-preview-09-2025","imageModelName":"imagen-4.0-generate-001","imageEditModelName":"gemini-2.5-flash-image-preview","imageTransformModelName":"gemini-3-pro-image-preview-11-2025","videoModelName":"veo-2.0-generate-001","ttsModelName":"gemini-2.5-flash-preview-tts","deprecatedTextModelNames":["gemini-2.0-flash","gemini-2.5-flash-preview-04-17","gemini-2.5-flash-preview-05-20"],"deprecatedImageModelNames":["imagen-3.0-generate-001","imagen-3.0-generate-002"]})</script><script>(function() {
  const originalConsoleLog = console.log;
  const originalConsoleError = console.error;

    /**
   * Normalizes an error event or a promise rejection reason into a structured error object.
   * @param {*} errorEventOrReason The error object or reason.
   * @return {object} Structured error data { message, name, stack }.
   */
  function getErrorObject(errorEventOrReason) {
    if (errorEventOrReason instanceof Error) {
      return {
        message: errorEventOrReason.message,
        name: errorEventOrReason.name,
        stack: errorEventOrReason.stack,
      };
    }
    // Fallback for non-Error objects.
    try {
      return {
        message: JSON.stringify(errorEventOrReason),
        name: 'UnknownErrorType',
        stack: null,
      };
    } catch (e) {
      return {
        message: String(errorEventOrReason),
        name: 'UnknownErrorTypeNonStringifiable',
        stack: null,
      };
    }
  }

  /**
   * Converts an array of arguments (from log/error) into a single string.
   * Handles Error objects specially to include their message and stack.
   * @param {Array<*>} args - Arguments passed to console methods.
   * @return {string} A string representation of the arguments.
   */
  function stringifyArgs(args) {
    return args
      .map((arg) => {
        if (arg instanceof Error) {
          const {message, stack} = arg;
          return `Error: ${message}${stack ? ('\nStack: ' + stack) : ''}`;
        }
        if (typeof arg === 'object' && arg !== null) {
          try {
            return JSON.stringify(arg);
          } catch (error) {
            return '[Circular Object]';
          }
        } else {
          return String(arg);
        }
      })
      .join(' ');
  }

  console.log = function(...args) {
    const logString = stringifyArgs(args);
    window.parent.postMessage({ type: 'log', message: logString }, '*');
    originalConsoleLog.apply(console, args);
  };

  console.error = function(...args) {
    let errorData;
    if (args.length > 0 && args[0] instanceof Error) {
      const err = args[0];
      // If the first arg is an Error, capture its details.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        ...getErrorObject(err),
        rawArgsString: stringifyArgs(args.slice(1)),
        timestamp: new Date().toISOString(),
      };
    } else {
      // If not an Error object, treat all args as a general error message.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        message: stringifyArgs(args),
        name: 'ConsoleLoggedError',
        stack: null,
        timestamp: new Date().toISOString(),
      };
    }
    window.parent.postMessage(errorData, '*');
    originalConsoleError.apply(console, args);
  };

  // Listen for global unhandled synchronous errors.
  window.addEventListener('error', function(event) {
    const errorDetails = event.error ? getErrorObject(event.error) : {
      message: event.message,
      name: 'GlobalError',
      stack: null,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
    };

    window.parent.postMessage({
      type: 'error',
      source: 'global',
      ...errorDetails,
      message: errorDetails.message || event.message,
      timestamp: new Date().toISOString(),
    }, '*');
  });

  // Listen for unhandled promise rejections (asynchronous errors).
  window.addEventListener('unhandledrejection', function(event) {
    const errorDetails = getErrorObject(event.reason);

    window.parent.postMessage({
      type: 'error',
      source: 'unhandledrejection',
      ...errorDetails,
      message: errorDetails.message || 'Unhandled Promise Rejection',
      timestamp: new Date().toISOString(),
    }, '*');
  });

})();</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>X con - Calculadora Multi-Orientaci√≥n</title>
    <!-- Cargamos scripts externos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" crossorigin="anonymous"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap');
        body { 
            font-family: 'Outfit', sans-serif; 
            background-color: #f8fafc; 
            -webkit-tap-highlight-color: transparent;
        }
        .card { background: white; border-radius: 1.5rem; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
        .gradient-bg { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        
        @media (max-width: 640px) {
            .card { border-radius: 1rem; padding: 1rem !important; }
            h1 { font-size: 1.875rem !important; }
        }

        /* Modal simple para la IA */
        #ia-modal { display: none; }
        .loader { border-top-color: #f59e0b; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.fixed{position:fixed}.inset-0{inset:0px}.z-50{z-index:50}.mx-auto{margin-left:auto;margin-right:auto}.mb-2{margin-bottom:0.5rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mt-4{margin-top:1rem}.block{display:block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-16{height:4rem}.h-64{height:16rem}.w-16{width:4rem}.w-full{width:100%}.min-w-\[500px\]{min-width:500px}.max-w-6xl{max-width:72rem}.max-w-md{max-width:28rem}.flex-1{flex:1 1 0%}.cursor-pointer{cursor:pointer}.appearance-none{-webkit-appearance:none;appearance:none}.grid-cols-1{grid-template-columns:repeat(1, minmax(0, 1fr))}.grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:0.5rem}.gap-3{gap:0.75rem}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.gap-8{gap:2rem}.space-y-3 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.75rem * var(--tw-space-y-reverse))}.space-y-4 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.space-y-6 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem * var(--tw-space-y-reverse))}.overflow-x-auto{overflow-x:auto}.rounded-2xl{border-radius:1rem}.rounded-3xl{border-radius:1.5rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-xl{border-radius:0.75rem}.rounded{border-radius:0.25rem}.border{border-width:1px}.border-2{border-width:2px}.border-4{border-width:4px}.border-b{border-bottom-width:1px}.border-l-8{border-left-width:8px}.border-t-4{border-top-width:4px}.border-amber-400{--tw-border-opacity:1;border-color:rgb(251 191 36 / var(--tw-border-opacity, 1))}.border-green-500{--tw-border-opacity:1;border-color:rgb(34 197 94 / var(--tw-border-opacity, 1))}.border-indigo-500{--tw-border-opacity:1;border-color:rgb(99 102 241 / var(--tw-border-opacity, 1))}.border-slate-100{--tw-border-opacity:1;border-color:rgb(241 245 249 / var(--tw-border-opacity, 1))}.border-slate-200{--tw-border-opacity:1;border-color:rgb(226 232 240 / var(--tw-border-opacity, 1))}.border-slate-50{--tw-border-opacity:1;border-color:rgb(248 250 252 / var(--tw-border-opacity, 1))}.bg-indigo-100{--tw-bg-opacity:1;background-color:rgb(224 231 255 / var(--tw-bg-opacity, 1))}.bg-indigo-600{--tw-bg-opacity:1;background-color:rgb(79 70 229 / var(--tw-bg-opacity, 1))}.bg-slate-100{--tw-bg-opacity:1;background-color:rgb(241 245 249 / var(--tw-bg-opacity, 1))}.bg-slate-200{--tw-bg-opacity:1;background-color:rgb(226 232 240 / var(--tw-bg-opacity, 1))}.bg-slate-50{--tw-bg-opacity:1;background-color:rgb(248 250 252 / var(--tw-bg-opacity, 1))}.bg-slate-900\/60{background-color:rgb(15 23 42 / 0.6)}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.p-2{padding:0.5rem}.p-3{padding:0.75rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.p-1{padding:0.25rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.pb-3{padding-bottom:0.75rem}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.font-mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-\[10px\]{font-size:10px}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-black{font-weight:900}.font-bold{font-weight:700}.font-extrabold{font-weight:800}.uppercase{text-transform:uppercase}.tracking-widest{letter-spacing:0.1em}.text-amber-500{--tw-text-opacity:1;color:rgb(245 158 11 / var(--tw-text-opacity, 1))}.text-amber-600{--tw-text-opacity:1;color:rgb(217 119 6 / var(--tw-text-opacity, 1))}.text-green-600{--tw-text-opacity:1;color:rgb(22 163 74 / var(--tw-text-opacity, 1))}.text-indigo-600{--tw-text-opacity:1;color:rgb(79 70 229 / var(--tw-text-opacity, 1))}.text-slate-400{--tw-text-opacity:1;color:rgb(148 163 184 / var(--tw-text-opacity, 1))}.text-slate-500{--tw-text-opacity:1;color:rgb(100 116 139 / var(--tw-text-opacity, 1))}.text-slate-600{--tw-text-opacity:1;color:rgb(71 85 105 / var(--tw-text-opacity, 1))}.text-slate-700{--tw-text-opacity:1;color:rgb(51 65 85 / var(--tw-text-opacity, 1))}.text-slate-800{--tw-text-opacity:1;color:rgb(30 41 59 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgb(0 0 0 / 0.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgb(0 0 0 / 0.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.outline-none{outline:2px solid transparent;outline-offset:2px}.backdrop-blur-sm{--tw-backdrop-blur:blur(4px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-colors{transition-property:color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.ease-linear{transition-timing-function:linear}.hover\:scale-\[1\.01\]:hover{--tw-scale-x:1.01;--tw-scale-y:1.01;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:bg-indigo-200:hover{--tw-bg-opacity:1;background-color:rgb(199 210 254 / var(--tw-bg-opacity, 1))}.hover\:bg-indigo-700:hover{--tw-bg-opacity:1;background-color:rgb(67 56 202 / var(--tw-bg-opacity, 1))}.hover\:bg-slate-300:hover{--tw-bg-opacity:1;background-color:rgb(203 213 225 / var(--tw-bg-opacity, 1))}.hover\:bg-slate-50:hover{--tw-bg-opacity:1;background-color:rgb(248 250 252 / var(--tw-bg-opacity, 1))}.focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.focus\:ring-amber-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(245 158 11 / var(--tw-ring-opacity, 1))}@media (min-width: 640px){.sm\:flex-row{flex-direction:row}}@media (min-width: 768px){.md\:h-80{height:20rem}.md\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.md\:flex-row{flex-direction:row}.md\:justify-start{justify-content:flex-start}.md\:p-8{padding:2rem}.md\:text-left{text-align:left}}@media (min-width: 1024px){.lg\:col-span-1{grid-column:span 1 / span 1}.lg\:col-span-2{grid-column:span 2 / span 2}.lg\:grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}}</style></head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4 text-center md:text-left">
            <div>
                <div class="flex items-center gap-3 justify-center md:justify-start">
                    <h1 class="text-4xl font-extrabold text-slate-800">X con <span class="text-amber-500">Solar</span></h1>
                    <button onclick="descargarPagina()" class="bg-slate-200 hover:bg-slate-300 text-slate-600 p-2 rounded-lg transition-colors shadow-sm" title="Descargar Calculadora HTML">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" x2="12" y1="15" y2="3"></line></svg>
                    </button>
                </div>
                <p class="text-slate-500">Estudio de Rendimiento Profesional</p>
            </div>
            <div class="flex flex-col sm:flex-row gap-3">
                <button onclick="document.getElementById('fileInput').click()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-2xl shadow-lg font-bold flex items-center gap-2 transition-all">
                    <span>üß†</span> Analizar Factura con IA
                </button>
                <input type="file" id="fileInput" class="hidden" accept="image/*,application/pdf" onchange="procesarArchivo(event)">
                <div class="gradient-bg text-white px-6 py-3 rounded-2xl shadow-lg font-bold flex items-center justify-center">
                    ‚òÄÔ∏è Potencia tu Tejado
                </div>
            </div>
        </header>

        <!-- Modal de Carga IA -->
        <div id="ia-modal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" style="display: none;">
            <div class="bg-white rounded-3xl p-8 max-w-md w-full text-center shadow-2xl">
                <div class="loader ease-linear rounded-full border-4 border-t-4 border-slate-200 h-16 w-16 mb-4 mx-auto"></div>
                <h3 class="text-xl font-bold text-slate-800 mb-2">MyIA Analizando...</h3>
                <p class="text-slate-500 text-sm">Estoy leyendo la factura para extraer el CUPS, datos del cliente y consumos mensuales.</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Panel de Configuraci√≥n -->
            <aside class="lg:col-span-1 space-y-6">
                <!-- Datos del Cliente -->
                <div class="card p-6 border-t-4 border-indigo-500">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <span>üë§</span> Datos del Cliente
                    </h2>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase">Nombre / Cliente</label>
                            <input type="text" id="nombre_cliente" placeholder="Nombre completo" class="w-full p-2 bg-slate-50 border border-slate-200 rounded-lg outline-none text-sm">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase">CUPS</label>
                            <input type="text" id="cups_cliente" placeholder="ES0000..." class="w-full p-2 bg-slate-50 border border-slate-200 rounded-lg outline-none text-sm font-mono uppercase">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase">Direcci√≥n</label>
                            <div class="flex gap-2">
                                <input type="text" id="direccion_cliente" placeholder="Calle, n√∫mero, ciudad..." class="flex-1 p-2 bg-slate-50 border border-slate-200 rounded-lg outline-none text-sm">
                                <button onclick="abrirGoogleMaps()" class="bg-indigo-100 hover:bg-indigo-200 text-indigo-600 p-2 rounded-lg transition-colors" title="Ver en Google Maps">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card p-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <span>üß≠</span> Reparto y Pendiente
                    </h2>
                    <div class="space-y-4">
                        <!-- SUR -->
                        <div class="grid grid-cols-2 gap-2 p-3 bg-slate-50 rounded-xl border border-slate-100">
                            <div>
                                <label class="block text-[10px] font-bold text-slate-400 uppercase">kWp Sur</label>
                                <input type="number" id="kwp_sur" value="5" step="0.1" onchange="calcular()" class="w-full p-2 bg-white border border-slate-200 rounded-lg outline-none">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-slate-400 uppercase">Inclinaci√≥n</label>
                                <select id="inc_sur" onchange="calcular()" class="w-full p-2 bg-white border border-slate-200 rounded-lg outline-none">
                                    <option value="0">0¬∞</option>
                                    <option value="10">10¬∞</option>
                                    <option value="20">20¬∞</option>
                                    <option value="35" selected="">35¬∞</option>
                                    <option value="45">45¬∞</option>
                                    <option value="60">60¬∞</option>
                                    <option value="90">90¬∞ (Fachada)</option>
                                </select>
                            </div>
                        </div>
                        <!-- ESTE -->
                        <div class="grid grid-cols-2 gap-2 p-3 bg-slate-50 rounded-xl border border-slate-100">
                            <div>
                                <label class="block text-[10px] font-bold text-slate-400 uppercase">kWp Este</label>
                                <input type="number" id="kwp_este" value="2.5" step="0.1" onchange="calcular()" class="w-full p-2 bg-white border border-slate-200 rounded-lg outline-none">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-slate-400 uppercase">Inclinaci√≥n</label>
                                <select id="inc_este" onchange="calcular()" class="w-full p-2 bg-white border border-slate-200 rounded-lg outline-none">
                                    <option value="0">0¬∞</option>
                                    <option value="10">10¬∞</option>
                                    <option value="20">20¬∞</option>
                                    <option value="35" selected="">35¬∞</option>
                                    <option value="45">45¬∞</option>
                                    <option value="60">60¬∞</option>
                                    <option value="90">90¬∞</option>
                                </select>
                            </div>
                        </div>
                        <!-- OESTE -->
                        <div class="grid grid-cols-2 gap-2 p-3 bg-slate-50 rounded-xl border border-slate-100">
                            <div>
                                <label class="block text-[10px] font-bold text-slate-400 uppercase">kWp Oeste</label>
                                <input type="number" id="kwp_oeste" value="0" step="0.1" onchange="calcular()" class="w-full p-2 bg-white border border-slate-200 rounded-lg outline-none">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-slate-400 uppercase">Inclinaci√≥n</label>
                                <select id="inc_oeste" onchange="calcular()" class="w-full p-2 bg-white border border-slate-200 rounded-lg outline-none">
                                    <option value="0">0¬∞</option>
                                    <option value="10">10¬∞</option>
                                    <option value="20">20¬∞</option>
                                    <option value="35" selected="">35¬∞</option>
                                    <option value="45">45¬∞</option>
                                    <option value="60">60¬∞</option>
                                    <option value="90">90¬∞</option>
                                </select>
                            </div>
                        </div>
                        <!-- NORTE -->
                        <div class="grid grid-cols-2 gap-2 p-3 bg-slate-50 rounded-xl border border-slate-100">
                            <div>
                                <label class="block text-[10px] font-bold text-slate-400 uppercase">kWp Norte</label>
                                <input type="number" id="kwp_norte" value="0" step="0.1" onchange="calcular()" class="w-full p-2 bg-white border border-slate-200 rounded-lg outline-none">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-slate-400 uppercase">Inclinaci√≥n</label>
                                <select id="inc_norte" onchange="calcular()" class="w-full p-2 bg-white border border-slate-200 rounded-lg outline-none">
                                    <option value="0">0¬∞</option>
                                    <option value="10">10¬∞</option>
                                    <option value="20">20¬∞</option>
                                    <option value="35" selected="">35¬∞</option>
                                    <option value="45">45¬∞</option>
                                    <option value="60">60¬∞</option>
                                    <option value="90">90¬∞</option>
                                </select>
                            </div>
                        </div>

                        <div class="bg-slate-100 w-full p-3 rounded-xl text-center">
                            <span class="text-[10px] block font-bold text-slate-400">TOTAL INSTALADO</span>
                            <span id="total_kwp_display" class="font-bold text-slate-700 text-lg">7.5 kWp</span>
                        </div>
                    </div>
                </div>

                <div class="card p-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <span>üí∞</span> Tarifas y Bater√≠a
                    </h2>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase">Compra (‚Ç¨)</label>
                                <input type="number" id="p_compra" value="0.15" step="0.01" onchange="calcular()" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase">Venta (‚Ç¨)</label>
                                <input type="number" id="p_venta" value="0.06" step="0.01" onchange="calcular()" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none">
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase">Autoconsumo Estimado (%)</label>
                            <select id="auto_perc" onchange="calcular()" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none appearance-none cursor-pointer focus:ring-2 focus:ring-amber-500">
                                <option value="0.2">20% (Bajo)</option>
                                <option value="0.3">30% (Medio-Bajo)</option>
                                <option value="0.4" selected="">40% (Est√°ndar)</option>
                                <option value="0.5">50% (Eficiente)</option>
                                <option value="0.6">60% (Alto)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase">Bater√≠a (Capacidad)</label>
                            <select id="bat_cap" onchange="calcular()" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none appearance-none cursor-pointer focus:ring-2 focus:ring-amber-500">
                                <option value="0">Sin Bater√≠a</option>
                                <option value="5" selected="">Bater√≠a 5 kWh</option>
                                <option value="10">Bater√≠a 10 kWh</option>
                                <option value="15">Bater√≠a 15 kWh</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="card p-6">
                    <h2 class="text-xl font-bold mb-4">üè† Consumo Factura (kWh)</h2>
                    <div class="grid grid-cols-3 gap-2" id="grid-consumo">
                    <div>
                        <label class="text-[10px] uppercase font-bold text-slate-400">Ene</label>
                        <input type="number" id="c-0" value="670" onchange="actualizarConsumoLocal(0)" class="w-full p-1 bg-slate-50 border rounded text-center text-sm">
                    </div>
                
                    <div>
                        <label class="text-[10px] uppercase font-bold text-slate-400">Feb</label>
                        <input type="number" id="c-1" value="730" onchange="actualizarConsumoLocal(1)" class="w-full p-1 bg-slate-50 border rounded text-center text-sm">
                    </div>
                
                    <div>
                        <label class="text-[10px] uppercase font-bold text-slate-400">Mar</label>
                        <input type="number" id="c-2" value="640" onchange="actualizarConsumoLocal(2)" class="w-full p-1 bg-slate-50 border rounded text-center text-sm">
                    </div>
                
                    <div>
                        <label class="text-[10px] uppercase font-bold text-slate-400">Abr</label>
                        <input type="number" id="c-3" value="610" onchange="actualizarConsumoLocal(3)" class="w-full p-1 bg-slate-50 border rounded text-center text-sm">
                    </div>
                
                    <div>
                        <label class="text-[10px] uppercase font-bold text-slate-400">May</label>
                        <input type="number" id="c-4" value="500" onchange="actualizarConsumoLocal(4)" class="w-full p-1 bg-slate-50 border rounded text-center text-sm">
                    </div>
                
                    <div>
                        <label class="text-[10px] uppercase font-bold text-slate-400">Jun</label>
                        <input type="number" id="c-5" value="520" onchange="actualizarConsumoLocal(5)" class="w-full p-1 bg-slate-50 border rounded text-center text-sm">
                    </div>
                
                    <div>
                        <label class="text-[10px] uppercase font-bold text-slate-400">Jul</label>
                        <input type="number" id="c-6" value="580" onchange="actualizarConsumoLocal(6)" class="w-full p-1 bg-slate-50 border rounded text-center text-sm">
                    </div>
                
                    <div>
                        <label class="text-[10px] uppercase font-bold text-slate-400">Ago</label>
                        <input type="number" id="c-7" value="670" onchange="actualizarConsumoLocal(7)" class="w-full p-1 bg-slate-50 border rounded text-center text-sm">
                    </div>
                
                    <div>
                        <label class="text-[10px] uppercase font-bold text-slate-400">Sep</label>
                        <input type="number" id="c-8" value="760" onchange="actualizarConsumoLocal(8)" class="w-full p-1 bg-slate-50 border rounded text-center text-sm">
                    </div>
                
                    <div>
                        <label class="text-[10px] uppercase font-bold text-slate-400">Oct</label>
                        <input type="number" id="c-9" value="610" onchange="actualizarConsumoLocal(9)" class="w-full p-1 bg-slate-50 border rounded text-center text-sm">
                    </div>
                
                    <div>
                        <label class="text-[10px] uppercase font-bold text-slate-400">Nov</label>
                        <input type="number" id="c-10" value="550" onchange="actualizarConsumoLocal(10)" class="w-full p-1 bg-slate-50 border rounded text-center text-sm">
                    </div>
                
                    <div>
                        <label class="text-[10px] uppercase font-bold text-slate-400">Dic</label>
                        <input type="number" id="c-11" value="500" onchange="actualizarConsumoLocal(11)" class="w-full p-1 bg-slate-50 border rounded text-center text-sm">
                    </div>
                </div>
                    <button onclick="resetDatos()" class="w-full mt-4 py-2 border-2 border-slate-200 text-slate-500 font-bold rounded-xl hover:bg-slate-50 text-sm">
                        Restablecer valores
                    </button>
                </div>
            </aside>

            <!-- Resultados -->
            <main class="lg:col-span-2 space-y-6">
                
                <div class="card p-6">
                    <div class="flex flex-wrap justify-between items-start mb-6 gap-4">
                        <h2 class="text-2xl font-bold">üìä Balance Energ√©tico</h2>
                        <div class="flex gap-6">
                            <div class="text-right">
                                <span class="text-xs font-bold text-slate-400 block uppercase">Consumo Total Anual</span>
                                <span id="total_cons_anual" class="text-xl font-black text-indigo-600">7340 kWh</span>
                            </div>
                            <div class="text-right">
                                <span class="text-xs font-bold text-slate-400 block uppercase">Producci√≥n Anual</span>
                                <span id="total_prod_anual" class="text-xl font-black text-amber-600">10.138 kWh</span>
                            </div>
                        </div>
                    </div>
                    <div class="h-64 md:h-80 w-full">
                        <canvas id="mainChart" style="box-sizing: border-box; display: block; height: 320px; width: 691.3px;" width="622" height="288"></canvas>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="card p-6 border-l-8 border-amber-400">
                        <h3 class="text-slate-500 font-bold uppercase text-xs tracking-widest">Gasto Solo Placas</h3>
                        <p class="text-3xl font-black text-slate-800" id="ahorro-sin-bat">228.51 ‚Ç¨</p>
                        <p class="text-sm text-slate-400">Estimaci√≥n Anual</p>
                    </div>
                    <div class="card p-6 border-l-8 border-green-500">
                        <h3 class="text-slate-500 font-bold uppercase text-xs tracking-widest">Gasto con Bater√≠a</h3>
                        <p class="text-3xl font-black text-slate-800" id="ahorro-con-bat">30.33 ‚Ç¨</p>
                        <p class="text-sm text-slate-400">M√°ximo Ahorro X con</p>
                    </div>
                </div>

                <div class="card p-6 overflow-x-auto">
                    <table class="w-full text-left min-w-[500px]">
                        <thead>
                            <tr class="text-slate-400 text-sm border-b">
                                <th class="pb-3">Mes</th>
                                <th class="pb-3">Consumo</th>
                                <th class="pb-3">Producci√≥n</th>
                                <th class="pb-3">Factura Sin Bat.</th>
                                <th class="pb-3 text-green-600">Factura Con Bat.</th>
                            </tr>
                        </thead>
                        <tbody id="tabla-resultados" class="text-slate-700">
                    <tr class="border-b border-slate-50 text-sm">
                        <td class="py-2 font-bold">Ene</td>
                        <td class="py-2">670</td>
                        <td class="py-2 text-amber-600">513</td>
                        <td class="py-2 text-slate-500">45.63‚Ç¨</td>
                        <td class="py-2 font-bold text-slate-800">27.54‚Ç¨</td>
                    </tr>
                
                    <tr class="border-b border-slate-50 text-sm">
                        <td class="py-2 font-bold">Feb</td>
                        <td class="py-2">730</td>
                        <td class="py-2 text-amber-600">588</td>
                        <td class="py-2 text-slate-500">47.97‚Ç¨</td>
                        <td class="py-2 font-bold text-slate-800">28.26‚Ç¨</td>
                    </tr>
                
                    <tr class="border-b border-slate-50 text-sm">
                        <td class="py-2 font-bold">Mar</td>
                        <td class="py-2">640</td>
                        <td class="py-2 text-amber-600">875</td>
                        <td class="py-2 text-slate-500">20.46‚Ç¨</td>
                        <td class="py-2 font-bold text-slate-800">3.18‚Ç¨</td>
                    </tr>
                
                    <tr class="border-b border-slate-50 text-sm">
                        <td class="py-2 font-bold">Abr</td>
                        <td class="py-2">610</td>
                        <td class="py-2 text-amber-600">988</td>
                        <td class="py-2 text-slate-500">10.29‚Ç¨</td>
                        <td class="py-2 font-bold text-green-600">-6.18‚Ç¨</td>
                    </tr>
                
                    <tr class="border-b border-slate-50 text-sm">
                        <td class="py-2 font-bold">May</td>
                        <td class="py-2">500</td>
                        <td class="py-2 text-amber-600">1138</td>
                        <td class="py-2 text-slate-500">-11.25‚Ç¨</td>
                        <td class="py-2 font-bold text-green-600">-24.75‚Ç¨</td>
                    </tr>
                
                    <tr class="border-b border-slate-50 text-sm">
                        <td class="py-2 font-bold">Jun</td>
                        <td class="py-2">520</td>
                        <td class="py-2 text-amber-600">1213</td>
                        <td class="py-2 text-slate-500">-13.47‚Ç¨</td>
                        <td class="py-2 font-bold text-green-600">-27.51‚Ç¨</td>
                    </tr>
                
                    <tr class="border-b border-slate-50 text-sm">
                        <td class="py-2 font-bold">Jul</td>
                        <td class="py-2">580</td>
                        <td class="py-2 text-amber-600">1250</td>
                        <td class="py-2 text-slate-500">-8.88‚Ç¨</td>
                        <td class="py-2 font-bold text-green-600">-24.54‚Ç¨</td>
                    </tr>
                
                    <tr class="border-b border-slate-50 text-sm">
                        <td class="py-2 font-bold">Ago</td>
                        <td class="py-2">670</td>
                        <td class="py-2 text-amber-600">1100</td>
                        <td class="py-2 text-slate-500">10.38‚Ç¨</td>
                        <td class="py-2 font-bold text-green-600">-7.71‚Ç¨</td>
                    </tr>
                
                    <tr class="border-b border-slate-50 text-sm">
                        <td class="py-2 font-bold">Sep</td>
                        <td class="py-2">760</td>
                        <td class="py-2 text-amber-600">838</td>
                        <td class="py-2 text-slate-500">36.39‚Ç¨</td>
                        <td class="py-2 font-bold text-slate-800">15.87‚Ç¨</td>
                    </tr>
                
                    <tr class="border-b border-slate-50 text-sm">
                        <td class="py-2 font-bold">Oct</td>
                        <td class="py-2">610</td>
                        <td class="py-2 text-amber-600">688</td>
                        <td class="py-2 text-slate-500">28.29‚Ç¨</td>
                        <td class="py-2 font-bold text-slate-800">11.82‚Ç¨</td>
                    </tr>
                
                    <tr class="border-b border-slate-50 text-sm">
                        <td class="py-2 font-bold">Nov</td>
                        <td class="py-2">550</td>
                        <td class="py-2 text-amber-600">513</td>
                        <td class="py-2 text-slate-500">31.95‚Ç¨</td>
                        <td class="py-2 font-bold text-slate-800">17.10‚Ç¨</td>
                    </tr>
                
                    <tr class="border-b border-slate-50 text-sm">
                        <td class="py-2 font-bold">Dic</td>
                        <td class="py-2">500</td>
                        <td class="py-2 text-amber-600">438</td>
                        <td class="py-2 text-slate-500">30.75‚Ç¨</td>
                        <td class="py-2 font-bold text-slate-800">17.25‚Ç¨</td>
                    </tr>
                </tbody>
                    </table>
                </div>

                <button onclick="abrirInforme()" class="w-full py-4 gradient-bg text-white font-bold rounded-2xl shadow-xl hover:scale-[1.01] transition-all">
                    üìÑ Generar Informe PDF
                </button>
            </main>
        </div>
    </div>

    <script>
        const apiKey = ""; // Inyectado por la plataforma
        const meses = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
        let consumosRealesFactura = [280, 710, 580, 540, 570, 600, 660, 590, 620, 480, 310, 440];

        const rendimientos = {
            sur: [75, 85, 125, 140, 160, 170, 175, 155, 120, 100, 75, 65],
            este: [55, 65, 100, 115, 135, 145, 150, 130, 95, 75, 55, 45],
            oeste: [55, 65, 100, 115, 135, 145, 150, 130, 95, 75, 55, 45],
            norte: [35, 45, 70, 85, 105, 115, 120, 100, 65, 50, 35, 30]
        };

        const getIncFactor = (grados) => {
            const g = parseInt(grados);
            if (g === 0) return 0.88; 
            if (g === 10) return 0.94;
            if (g === 20) return 0.98;
            if (g === 35) return 1.0; 
            if (g === 45) return 0.96;
            if (g === 60) return 0.85;
            if (g === 90) return 0.60;
            return 1.0;
        };

        let myChart;
        let datosIA = { cups: "", cliente: "", direccion: "", hayGrafica: false, mensajeGrafica: "" };

        // Funci√≥n para abrir Google Maps
        function abrirGoogleMaps(dirInputId = 'direccion_cliente') {
            const direccion = document.getElementById(dirInputId)?.value || document.getElementById('direccion_cliente').value;
            if (!direccion || direccion === "---") {
                alert("Primero introduce o analiza una direcci√≥n, colega.");
                return;
            }
            const url = `https://www.google.com/maps/search/${encodeURIComponent(direccion)}`;
            window.open(url, '_blank');
        }

        window.inyectarConsumosIA = (nuevosConsumos, metaData) => {
            if(nuevosConsumos && nuevosConsumos.length === 12) {
                consumosRealesFactura = nuevosConsumos.map(c => parseFloat(c) || 0);
                renderGridConsumo();
                
                if (metaData) {
                    if (metaData.cliente) document.getElementById('nombre_cliente').value = metaData.cliente;
                    if (metaData.cups) document.getElementById('cups_cliente').value = metaData.cups;
                    if (metaData.direccion) document.getElementById('direccion_cliente').value = metaData.direccion;
                    datosIA = metaData;
                }
                
                calcular();
            }
        };

        function renderGridConsumo() {
            const gridConsumo = document.getElementById('grid-consumo');
            gridConsumo.innerHTML = "";
            meses.forEach((mes, i) => {
                gridConsumo.innerHTML += `
                    <div>
                        <label class="text-[10px] uppercase font-bold text-slate-400">${mes}</label>
                        <input type="number" id="c-${i}" value="${consumosRealesFactura[i]}" onchange="actualizarConsumoLocal(${i})" class="w-full p-1 bg-slate-50 border rounded text-center text-sm">
                    </div>
                `;
            });
        }

        function actualizarConsumoLocal(i) {
            consumosRealesFactura[i] = parseFloat(document.getElementById(`c-${i}`).value) || 0;
            calcular();
        }

        async function procesarArchivo(event) {
            const file = event.target.files[0];
            if (!file) return;

            const modal = document.getElementById('ia-modal');
            modal.style.display = 'flex';

            const reader = new FileReader();
            reader.onload = async (e) => {
                const base64Data = e.target.result.split(',')[1];
                const mimeType = file.type;

                const prompt = `Analiza esta factura el√©ctrica. Extrae: 
                1. Nombre del cliente.
                2. C√≥digo CUPS.
                3. Direcci√≥n completa de suministro.
                4. Consumo mensual (kWh) de los √∫ltimos 12 meses.
                IMPORTANTE: Si hay gr√°fica, lee los valores reales. Si no hay gr√°fica o es ilegible, genera una estimaci√≥n realista para un hogar espa√±ol basada en el consumo total anual (si aparece) o en un perfil est√°ndar (media 350kWh/mes con picos en invierno/verano).
                Responde EXCLUSIVAMENTE en formato JSON con esta estructura:
                {
                    "cliente": "nombre",
                    "cups": "c√≥digo",
                    "direccion": "direcci√≥n completa",
                    "consumos": [120, 150, ...], 
                    "hayGrafica": true/false,
                    "mensajeGrafica": "texto descriptivo"
                }`;

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [
                                    { text: prompt },
                                    { inlineData: { mimeType: mimeType, data: base64Data } }
                                ]
                            }],
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    });

                    const result = await response.json();
                    const data = JSON.parse(result.candidates[0].content.parts[0].text);
                    
                    datosIA = data;
                    modal.style.display = 'none';
                    mostrarResultadoIA(data);

                } catch (err) {
                    console.error(err);
                    modal.style.display = 'none';
                    alert("¬°Vaya! Algo ha fallado analizando la factura. Prueba con otra foto o PDF.");
                }
            };
            reader.readAsDataURL(file);
        }

        function mostrarResultadoIA(data) {
            const win = window.open("", "_blank");
            const esReal = data.hayGrafica;
            const statusColor = esReal ? 'text-green-600' : 'text-amber-600';
            const statusIcon = esReal ? '‚úÖ' : '‚ö†Ô∏è';
            const consumosStr = JSON.stringify(data.consumos);
            const metaStr = JSON.stringify({
                cliente: data.cliente || "",
                cups: data.cups || "",
                direccion: data.direccion || "",
                hayGrafica: data.hayGrafica,
                mensajeGrafica: data.mensajeGrafica
            });

            win.document.write(`
                <html>
                <head>
                    <title>MyIA - Datos Detectados</title>
                    <script src="https://cdn.tailwindcss.com"><\/script>
                    <style>@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap'); body { font-family: 'Outfit', sans-serif; }</style>
                </head>
                <body class="p-8 bg-slate-50">
                    <div class="max-w-2xl mx-auto bg-white p-8 rounded-3xl shadow-xl border border-slate-100">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-3xl font-black text-slate-800 flex items-center gap-2"><span>üß†</span> MyIA Detecta</h1>
                            <span class="bg-slate-100 px-3 py-1 rounded-full text-xs font-bold text-slate-500">Inteligencia Artificial X con</span>
                        </div>
                        
                        <div class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-slate-50 p-4 rounded-2xl">
                                    <p class="text-[10px] font-bold text-slate-400 uppercase">Cliente</p>
                                    <p class="text-lg font-bold text-slate-800">${data.cliente || 'No detectado'}</p>
                                </div>
                                <div class="bg-slate-50 p-4 rounded-2xl">
                                    <p class="text-[10px] font-bold text-slate-400 uppercase">CUPS</p>
                                    <p class="text-lg font-bold text-indigo-600">${data.cups || 'No detectado'}</p>
                                </div>
                            </div>
                            
                            <div class="bg-slate-50 p-4 rounded-2xl flex justify-between items-center">
                                <div class="flex-1">
                                    <p class="text-[10px] font-bold text-slate-400 uppercase">Direcci√≥n de Suministro</p>
                                    <p class="text-sm font-bold text-slate-600" id="dir_detectada">${data.direccion || 'No detectada'}</p>
                                </div>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent(document.getElementById('dir_detectada').innerText), '_blank')" class="ml-4 bg-indigo-600 text-white p-3 rounded-xl hover:bg-indigo-700 transition-colors">
                                    üìç
                                </button>
                            </div>

                            <div class="p-6 rounded-2xl border-2 border-dashed border-slate-200 bg-white">
                                <h3 class="font-bold text-slate-800 mb-2 flex items-center gap-2">
                                    <span>üìä</span> An√°lisis de Consumo
                                </h3>
                                <p class="${statusColor} font-bold mb-3">${statusIcon} ${data.mensajeGrafica}</p>
                                
                                <div class="grid grid-cols-4 sm:grid-cols-6 gap-2">
                                    ${data.consumos.map((c, i) => `
                                        <div class="text-center bg-slate-50 p-2 rounded-lg">
                                            <p class="text-[8px] uppercase font-bold text-slate-400">${['E','F','M','A','M','J','J','A','S','O','N','D'][i]}</p>
                                            <p class="text-xs font-bold text-slate-700">${c}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            <div class="pt-4">
                                <button onclick="aplicarYSalir()" class="w-full py-4 bg-indigo-600 text-white font-bold rounded-2xl shadow-lg hover:bg-indigo-700 transition-all flex items-center justify-center gap-2">
                                    üöÄ Volver e Importar Todo
                                </button>
                                <p class="text-center text-[10px] text-slate-400 mt-3 italic">Al pulsar, se rellenar√°n autom√°ticamente el nombre, CUPS, direcci√≥n y consumos.</p>
                            </div>
                        </div>
                    </div>
                    <script>
                        function aplicarYSalir() {
                            if (window.opener && !window.opener.closed) {
                                window.opener.inyectarConsumosIA(${consumosStr}, ${metaStr});
                                window.close();
                            } else {
                                alert("La ventana principal se ha cerrado.");
                            }
                        }
                    <\/script>
                </body>
                </html>
            `);
            win.document.close();
        }

        function descargarPagina() {
            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = 'Calculadora_Xcon_Solar.html';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        function resetDatos() {
            consumosRealesFactura = [280, 710, 580, 540, 570, 600, 660, 590, 620, 480, 310, 440];
            document.getElementById('nombre_cliente').value = "";
            document.getElementById('cups_cliente').value = "";
            document.getElementById('direccion_cliente').value = "";
            renderGridConsumo();
            calcular();
        }

        function calcular() {
            const kSur = parseFloat(document.getElementById('kwp_sur').value) || 0;
            const kEste = parseFloat(document.getElementById('kwp_este').value) || 0;
            const kOeste = parseFloat(document.getElementById('kwp_oeste').value) || 0;
            const kNorte = parseFloat(document.getElementById('kwp_norte').value) || 0;
            
            const incS = getIncFactor(document.getElementById('inc_sur').value);
            const incE = getIncFactor(document.getElementById('inc_este').value);
            const incO = getIncFactor(document.getElementById('inc_oeste').value);
            const incN = getIncFactor(document.getElementById('inc_norte').value);

            const batCap = parseFloat(document.getElementById('bat_cap').value) || 0;
            const autoPerc = parseFloat(document.getElementById('auto_perc').value) || 0.4;
            
            const totalKwp = kSur + kEste + kOeste + kNorte;
            document.getElementById('total_kwp_display').innerText = `${totalKwp.toFixed(1)} kWp`;

            const pCompra = parseFloat(document.getElementById('p_compra').value);
            const pVenta = parseFloat(document.getElementById('p_venta').value);
            const consumos = meses.map((_, i) => parseFloat(document.getElementById(`c-${i}`).value) || 0);
            
            const totalConsAnual = consumos.reduce((a, b) => a + b, 0);
            document.getElementById('total_cons_anual').innerText = `${Math.round(totalConsAnual).toLocaleString()} kWh`;

            const producciones = meses.map((_, i) => 
                (kSur * rendimientos.sur[i] * incS) + 
                (kEste * rendimientos.este[i] * incE) + 
                (kOeste * rendimientos.oeste[i] * incO) + 
                (kNorte * rendimientos.norte[i] * incN)
            );

            const totalProdAnual = producciones.reduce((a, b) => a + b, 0);
            document.getElementById('total_prod_anual').innerText = `${Math.round(totalProdAnual).toLocaleString()} kWh`;

            const dataActual = [], dataSoloPlacas = [], dataConBat = [], dataProd = [];
            let tablaHTML = "", tActual = 0, tSolo = 0, tBat = 0;

            let batAddedFactor = 0; 
            if(batCap > 0) {
                if(batCap <= 5) batAddedFactor = 0.30;
                else if(batCap <= 10) batAddedFactor = 0.45;
                else batAddedFactor = 0.55;
            }

            meses.forEach((mes, i) => {
                const c = consumos[i];
                const p = producciones[i];
                dataProd.push(p.toFixed(0));
                
                const costA = c * pCompra;
                dataActual.push(costA.toFixed(2));
                tActual += costA;

                const autoS = Math.min(c * autoPerc, p);
                const expS = Math.max(0, p - autoS);
                const impS = Math.max(0, c - autoS);
                const totalS = (impS * pCompra) - (expS * pVenta);
                dataSoloPlacas.push(totalS.toFixed(2));
                tSolo += totalS;

                const totalAutoPercB = Math.min(0.98, autoPerc + batAddedFactor);
                const autoB = Math.min(c * totalAutoPercB, p);
                const expB = Math.max(0, p - autoB);
                const impB = Math.max(0, c - autoB);
                const totalB = (impB * pCompra) - (expB * pVenta);
                dataConBat.push(totalB.toFixed(2));
                tBat += totalB;

                tablaHTML += `
                    <tr class="border-b border-slate-50 text-sm">
                        <td class="py-2 font-bold">${mes}</td>
                        <td class="py-2">${c}</td>
                        <td class="py-2 text-amber-600">${Math.round(p)}</td>
                        <td class="py-2 text-slate-500">${totalS.toFixed(2)}‚Ç¨</td>
                        <td class="py-2 font-bold ${totalB < 0 ? 'text-green-600' : 'text-slate-800'}">${totalB.toFixed(2)}‚Ç¨</td>
                    </tr>
                `;
            });

            document.getElementById('tabla-resultados').innerHTML = tablaHTML;
            document.getElementById('ahorro-sin-bat').innerText = tSolo.toFixed(2) + " ‚Ç¨";
            document.getElementById('ahorro-con-bat').innerText = tBat.toFixed(2) + " ‚Ç¨";

            updateChart(dataActual, dataSoloPlacas, dataConBat, dataProd);
        }

        function updateChart(actual, solo, bat, prod) {
            if (myChart) myChart.destroy();
            const ctx = document.getElementById('mainChart').getContext('2d');
            myChart = new Chart(ctx, {
                data: {
                    labels: meses,
                    datasets: [
                        { 
                            type: 'bar', label: 'Gasto Sin Solar (‚Ç¨)', data: actual, 
                            backgroundColor: '#cbd5e1', borderRadius: 5, order: 2, yAxisID: 'y'
                        },
                        { 
                            type: 'bar', label: 'Gasto Solo Placas (‚Ç¨)', data: solo, 
                            backgroundColor: '#fcd34d', borderRadius: 5, order: 3, yAxisID: 'y'
                        },
                        { 
                            type: 'bar', label: 'Gasto Con Bat. (‚Ç¨)', data: bat, 
                            backgroundColor: '#22c55e', borderRadius: 5, order: 4, yAxisID: 'y'
                        },
                        { 
                            type: 'line', label: 'Generaci√≥n Solar (kWh)', data: prod, 
                            borderColor: '#f59e0b', backgroundColor: '#f59e0b', borderWidth: 3,
                            pointRadius: 4, pointBackgroundColor: '#fff', tension: 0.4, order: 1, yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    scales: { 
                        y: { 
                            beginAtZero: true, position: 'left',
                            title: { display: true, text: 'Gasto (‚Ç¨)', font: { family: 'Outfit', weight: 'bold' } }
                        },
                        y1: {
                            beginAtZero: true, position: 'right',
                            title: { display: true, text: 'Producci√≥n (kWh)', font: { family: 'Outfit', weight: 'bold' } },
                            grid: { drawOnChartArea: false }
                        }
                    },
                    plugins: { legend: { position: 'bottom', labels: { boxWidth: 10, font: { family: 'Outfit', size: 10 } } } }
                }
            });
        }

        function abrirInforme() {
            const canvas = document.getElementById('mainChart');
            const chartImage = canvas.toDataURL('image/png');
            const totalKwp = document.getElementById('total_kwp_display').innerText;
            const bat = document.getElementById('bat_cap').value;
            const autoPercText = (parseFloat(document.getElementById('auto_perc').value) * 100) + "%";
            
            const totalConsAnual = document.getElementById('total_cons_anual').innerText;
            const totalProdAnual = document.getElementById('total_prod_anual').innerText;
            const gastoPlacas = document.getElementById('ahorro-sin-bat').innerText;
            const gastoBateria = document.getElementById('ahorro-con-bat').innerText;
            const tabla = document.getElementById('tabla-resultados').innerHTML;
            
            const cli_nom = document.getElementById('nombre_cliente').value || "---";
            const cli_cups = document.getElementById('cups_cliente').value || "---";
            const cli_dir = document.getElementById('direccion_cliente').value || "---";

            const win = window.open("", "_blank");
            win.document.write(`
                <html>
                <head>
                    <title>Estudio Solar X con</title>
                    <script src="https://cdn.tailwindcss.com"><\/script>
                    <style>@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap'); body { font-family: 'Outfit', sans-serif; }</style>
                </head>
                <body class="p-10 bg-white">
                    <div class="max-w-4xl mx-auto border p-8 rounded-3xl shadow-sm">
                        <div class="flex justify-between items-start mb-8">
                            <div>
                                <h1 class="text-4xl font-black mb-1 text-slate-800">Estudio Energ√©tico <span class="text-amber-500">X con Solar</span></h1>
                                <p class="text-slate-400 font-bold uppercase tracking-wider text-sm">Proyecci√≥n Profesional de Ahorro</p>
                            </div>
                            <div class="text-right bg-amber-50 p-4 rounded-2xl border border-amber-100">
                                <p class="text-xs font-bold text-amber-600 uppercase">Instalaci√≥n Total</p>
                                <p class="text-2xl font-black text-slate-800">${totalKwp}</p>
                            </div>
                        </div>

                        <div class="mb-8 p-6 bg-indigo-50 rounded-2xl border border-indigo-100 grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <p class="text-[10px] font-bold text-indigo-400 uppercase tracking-widest">Cliente</p>
                                <p class="font-bold text-slate-800 text-lg">${cli_nom}</p>
                            </div>
                            <div>
                                <p class="text-[10px] font-bold text-indigo-400 uppercase tracking-widest">CUPS</p>
                                <p class="font-bold text-indigo-600 font-mono text-lg uppercase">${cli_cups}</p>
                            </div>
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-[10px] font-bold text-indigo-400 uppercase tracking-widest">Direcci√≥n</p>
                                    <p class="font-bold text-slate-700" id="dir_informe">${cli_dir}</p>
                                </div>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent(document.getElementById('dir_informe').innerText), '_blank')" class="bg-indigo-600 text-white p-2 rounded-xl text-xs font-bold shadow-md">
                                    VER MAPA
                                </button>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                            <div class="p-4 rounded-2xl border bg-slate-50">
                                <p class="text-[10px] font-bold text-slate-400 uppercase">Consumo Total</p>
                                <p class="text-xl font-black text-indigo-600">${totalConsAnual}</p>
                            </div>
                            <div class="p-4 rounded-2xl border bg-slate-50">
                                <p class="text-[10px] font-bold text-slate-400 uppercase">Prod. Total</p>
                                <p class="text-xl font-black text-amber-600">${totalProdAnual}</p>
                            </div>
                            <div class="p-4 rounded-2xl border border-amber-200 bg-amber-50">
                                <p class="text-[10px] font-bold text-amber-600 uppercase">Gasto Solo Placas</p>
                                <p class="text-xl font-black text-slate-800">${gastoPlacas}</p>
                            </div>
                            <div class="p-4 rounded-2xl border border-green-500 bg-green-50">
                                <p class="text-[10px] font-bold text-green-600 uppercase">Gasto con Bater√≠a</p>
                                <p class="text-xl font-black text-green-600">${gastoBateria}</p>
                            </div>
                        </div>

                        <div class="mb-8 text-center">
                            <h2 class="text-lg font-bold mb-4 text-slate-700">üìà Proyecci√≥n Gr√°fica</h2>
                            <img src="${chartImage}" class="max-w-full h-auto mx-auto border rounded-2xl">
                        </div>

                        <h2 class="text-lg font-bold mb-4 text-slate-700">üìã Desglose Mensual</h2>
                        <table class="w-full text-sm">
                            <thead class="bg-slate-50">
                                <tr class="text-left text-slate-500">
                                    <th class="p-3 uppercase text-[10px]">Mes</th>
                                    <th class="p-3 uppercase text-[10px]">Consumo</th>
                                    <th class="p-3 uppercase text-[10px]">Prod.</th>
                                    <th class="p-3 uppercase text-[10px]">Sin Bat.</th>
                                    <th class="p-3 text-green-600 uppercase text-[10px]">Con Bat.</th>
                                </tr>
                            </thead>
                            <tbody>${tabla}</tbody>
                        </table>
                        
                        <footer class="mt-12 text-center text-slate-400 text-[10px] border-t pt-4">
                            Este documento es una estimaci√≥n basada en perfiles de rendimiento solar est√°ndar. No constituye contrato vinculante. 
                            Emitido por X con Solar.
                        </footer>
                    </div>
                </body>
                </html>
            `);
            win.document.close();
        }

        window.onload = () => {
            renderGridConsumo();
            calcular();
        };
    </script>

</body></html>